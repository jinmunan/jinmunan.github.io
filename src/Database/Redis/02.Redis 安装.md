---
icon: page
order: 2
---
# Redis 安装

+ Redis 是一个`开源`的`key-value`存储系统。
+ 和 Memcached 类似，它支持存储的 value 类型相对更多，包括`string`(字符串)、`list`(链表)、`set`(集合)、`zset`(sorted set --有序集合) 和`hash`（哈希类型）。
+ 这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是`原子性`的。
+ 在此基础上，Redis 支持各种不同方式的`排序`。
+ 与 memcached 一样，为了保证效率，数据都是`缓存在内存`中。
+   区别的是 Redis 会`周期性`的把更新的`数据写入磁盘`或者把修改操作写入追加的记录文件。
+  并且在此基础上实现了`master-slave(主从)`同步。

## 应用场景

### 配合关系型数据库做高速缓存

+ 高频次，热门访问的数据，降低数据库 IO
+ 分布式架构，做 session 共享

![image-20230329125014222](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20230329125014222.png)

### 多样的数据结构存储持久化数据

![image-20230329125026942](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20230329125026942.png)

## Redis 安装

+ [Redis 官方网站](https://redis.io/)
+ [Redis 中文官方网站](http://redis.cn/)

### 安装版本

不用考虑在 windows 环境下对 Redis 的支持

### 安装步骤

[官方文档 - 从源安装 Redis](https://redis.io/docs/getting-started/installation/install-redis-from-source/)

①获取最新稳定版 Redis 的源文件

```sh
wget https://download.redis.io/redis-stable.tar.gz /opt/redis
```

②安装 C 语言的编译环境

```sh
yum -y install gcc-c++
```

③测试 gcc 版本

```sh
gcc --version
```

④解压文件

```sh
tar -zxvf redis-stable.tar.gz
```

⑤解压完进入目录执行 make 命令编译

```sh
cd redis-stable
ls
make && make install
```

![image-20230329131437968](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20230329131437968.png)

⑥切换到/usr/local/bin，并查看

```sh
cd /usr/local/bin
ls
```

![image-20230329131504250](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20230329131504250.png)

### 后台启动 (推荐)

拷贝一份 redis.conf 到其它目录

```sh
cd /opt/redis/redis-stable
cp redis.conf /etc/redis.conf
```

修改 etc 目录下的 redis.conf 文件将里面的`daemonize no` 改成 `daemonize yes`，让服务在后台启动

```sh
vim /etc/redis.conf

/daemonize
daemonize yes
```

切换到/usr/local/bin,使用启动命令`redis-server /etc/redis.conf`

```sh
cd /usr/local/bin/
redis-server /etc/redis.conf
```

查看关于 redis 线程状态

```sh
[root@jinmunan bin]# ps -ef | grep redis
root     16816     1  0 01:21 ?        00:00:00 redis-server 127.0.0.1:6379
root     16822  1254  0 01:21 pts/0    00:00:00 grep --color=auto redis
```

#### 客户端访问 redis

使用命令`redis-cli`,使用`ping`查看链接状态

```sh
[root@jinmunan bin]# redis-cli
127.0.0.1:6379> ping
PONG
```

关闭 redis，使用命令`shutdown`

```sh
127.0.0.1:6379> shutdown
not connected>
```

多实例关闭，指定端口关闭：redis-cli -p 6379 shutdown

也可以通过杀进程关闭 kill -9 进程号

### 前台启动

使用命令`redis-server`

<mark>这个窗口就不能再做其他操作了，不推荐</mark>

```sh
[root@jinmunan bin]# redis-server
16951:C 29 Mar 2023 01:25:14.301 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
16951:C 29 Mar 2023 01:25:14.302 # Redis version=7.0.10, bits=64, commit=00000000, modified=0, pid=16951, just started
16951:C 29 Mar 2023 01:25:14.302 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
16951:M 29 Mar 2023 01:25:14.302 * monotonic clock: POSIX clock_gettime
                _._                                                  
           _.-``__ ''-._                                             
      _.-``    `.  `_.  ''-._           Redis 7.0.10 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ ''-._                                  
 (    '      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379
 |    `-._   `._    /     _.-'    |     PID: 16951
  `-._    `-._  `-./  _.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |           https://redis.io       
  `-._    `-._`-.__.-'_.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |                                  
  `-._    `-._`-.__.-'_.-'    _.-'                                   
      `-._    `-.__.-'    _.-'                                       
          `-._        _.-'                                           
              `-.__.-'                                               

16951:M 29 Mar 2023 01:25:14.303 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
16951:M 29 Mar 2023 01:25:14.303 # Server initialized
16951:M 29 Mar 2023 01:25:14.303 # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.
16951:M 29 Mar 2023 01:25:14.303 * Loading RDB produced by version 7.0.10
16951:M 29 Mar 2023 01:25:14.303 * RDB age 48 seconds
16951:M 29 Mar 2023 01:25:14.303 * RDB memory usage when created 0.89 Mb
16951:M 29 Mar 2023 01:25:14.303 * Done loading RDB, keys loaded: 0, keys expired: 0.
16951:M 29 Mar 2023 01:25:14.303 * DB loaded from disk: 0.000 seconds
16951:M 29 Mar 2023 01:25:14.304 * Ready to accept connections
^C16951:signal-handler (1680067515) Received SIGINT scheduling shutdown...
16951:M 29 Mar 2023 01:25:15.713 # User requested shutdown...
16951:M 29 Mar 2023 01:25:15.713 * Saving the final RDB snapshot before exiting.
16951:M 29 Mar 2023 01:25:15.715 * DB saved on disk
16951:M 29 Mar 2023 01:25:15.716 # Redis is now ready to exit, bye bye...
```

## Redis 介绍相关知识

### 端口 6379 从何而来？

Alessia  Merz

### 基本命令

默认 16 个数据库，类似数组下标从 0 开始，初始`默认使用0号库`

使用命令 `select <dbid>` 来切换数据库。如：`select 8`

统一密码管理，所有库同样密码。

`dbsize`  查看当前数据库的 key 的数量

`flushdb` 清空当前库

`flushall` 通杀全部库

### Redis 是单线程 + 多路 IO 复用技术

多路复用是指使用一个线程来检查多个文件描述符（Socket）的就绪状态，比如调用 select 和 poll 函数，传入多个文件描述符，如果有一个文件描述符就绪，则返回，否则阻塞直到超时。得到就绪状态后进行真正的操作可以在同一个线程里执行，也可以启动线程执行（比如使用线程池）

`串行 vs 多线程+锁（memcached） vs 单线程+多路IO复用(Redis)`

（与 Memcache 三点不同：支持多数据类型，支持持久化，单线程 + 多路 IO 复用）  

![image-20230329132625575](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20230329132625575.png)
