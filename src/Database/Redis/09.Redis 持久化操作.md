---
icon: page
order: 9
---
## 持久化 RDB

RDB（Redis DataBase）模式

### 持久化 RDB 是什么

- 在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的 Snapshot 快照，它恢复时是将快照文件直接读到内存里
- Redis 会单独创建（fork）一个子进程来进行持久化，会先将数据写入到 一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何 IO 操作的，这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那 RDB 方式要比 AOF 方式更加的高效。RDB 的缺点是最后一次持久化后的数据可能丢失

- rdb 保存的是 dump.rdb 文件
- 相关配置在配置文件的位置 - 在 redis.conf 搜寻`### SNAPSHOTTING ###`

### 如何触发 RDB 快照

- 配置文件中默认的快照配置 dbfilename dump.rdb
  - 冷拷贝后重新使用
    - 可以 cp dump.rdb dump_new.rdb
- 命令 save 或者是 bgsave
  - Save：save 时只管保存，其它不管，全部阻塞
  - BGSAVE：Redis 会在后台异步进行快照操作，快照同时还可以响应客户端请求。可以通过 lastsave 命令获取最后一次成功执行快照的时间
- 执行 flushall 命令，也会产生 dump.rdb 文件，但里面是空的，无意义

### 如何恢复

- 将备份文件 (dump.rdb) 移动到 redis 安装目录并启动服务即可
- `CONFIG GET dir`获取目录

### 优势与劣势

- 优势
  - 适合大规模的数据恢复
  - 对数据完整性和一致性要求不高
- 劣势
  - 在一定间隔时间做一次备份，所以如果 redis 意外 down 掉的话，就 会丢失最后一次快照后的所有修改
  - Fork 的时候，内存中的数据被克隆了一份，大致 2 倍的膨胀性需要考虑

### 如何停止

动态所有停止 RDB 保存规则的方法：`redis-cli config set save ""`

### 小结

![img](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/aHR0cHM6Ly9naXRlZS5jb20vamFsbGVua3dvbmcvTGVhcm5SZWRpcy9yYXcvbWFzdGVyL2ltYWdlLzIxLnBuZw)

- RDB 是一个非常紧凑的文件。
- RDB 在保存 RDB 文件时父进程唯一需要做的就是 fork 出一个子进程，接下来的工作全部由子进程来做，父进程不需要再做其他 I0 操作，所以 RDB 持久化方式可以最大化 redis 的性能。
- 与 AOF 相比，在恢复大的数据集的时候，RDB 方式会更快一一些。
- 数据丢失风险大。
- RDB 需要经常 fork 子进程来保存数据集到硬盘上，当数据集比较大的时候 fork 的过程是非常耗时的吗，可能会导致 Redis 在一些毫秒级不能回应客户端请求。

## 持久化 AOF

AOF (Append Only File)

### 持久化 AOF 是什么

### AOF 配置

### AOF启动/修复/恢复

### rewrite

### 优势与劣势

### 小结

![img](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/aHR0cHM6Ly9naXRlZS5jb20vamFsbGVua3dvbmcvTGVhcm5SZWRpcy9yYXcvbWFzdGVyL2ltYWdlLzIyLnBuZw)
