---
icon: page
order: 8
---
# 九、Redis 事务

## 1、Redis 事务

> redis 的事务不同于 mysql 的事务，redis 事务是指串联的执行多个命令，所有的命令都会被序列化，按顺序执行不会被其他命令打断，插队

## 2、Multi、Exec、discard

| 命令    | 含义                                |
| ------- | ----------------------------------- |
| Multi   | 开启 redis 事务，所有命令依次进入队列 |
| Exec    | 按队列顺序将命令执行，事务结束      |
| discard | 放弃进入队列的所有命令，事务结束    |

![image-20220420162919525](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20220420162919525.png)

![image-20220420163123564](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20220420163123564.png)

## 3、组队错误的两种情况

1. 组队时出现错误，exec 执行后，所有的命令都不会执行
2. 组队时不出现错误，exec 执行后报错，只有报错的命令不会执行

## 4、悲观锁

- 模拟场景：10000 的库存，同一时间分别有 8000、5000 和 2000 的购买订单

> 每次去拿数据的时候都会上锁

![image-20220420164410238](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20220420164410238.png)

## 5、乐观锁

> 每次去拿数据的时候都不会上锁，采用版本号机制

![image-20220420165123533](https://cdn.staticaly.com/gh/jinmunan/imgs@master/Redis/image-20220420165123533.png)

## 6, watch key

**当监视的 key 被修改后，另一个命令将不会执行**

## 7、Redis 事务特性

- 单独的隔离操作：所有的命令都会序列化，按照队列执行，不会被打断
- 没有隔离级别的概念：队列中的命令没有提交之前都不会实际被执行
- 不保证原子性：组队中如果有一条命令成功，执行失败，其后的命令仍然会被执行，没有回滚 
