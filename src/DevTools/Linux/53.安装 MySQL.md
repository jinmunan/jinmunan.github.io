---
icon: page
order: 27
---
# 安装 MySQL

参照：[https://www.jianshu.com/p/276d59cbc529](https://www.jianshu.com/p/276d59cbc529)

## 安装前准备

```sh
# 检查是否已经安装过mysql，执行命令
rpm -qa | grep mysql
# 执行删除命令
rpm -e --nodeps xxx
# 再次执行查询命令，查看是否删除

# 查询所有Mysql对应的文件夹
whereis mysql
find / -name mysql
# 删除相关目录或文件
rm -rf /usr/bin/mysql /usr/include/mysql ...
# 验证是否删除完毕

# 检查mysql用户组和用户是否存在，如果有，先删除，如果没有，则创建
cat /etc/group | grep mysql
cat /etc/passwd | grep mysql
# 删除
userdel mysql
groupdel mysql
# 创建
groupadd mysql
useradd -r -g mysql mysql

# 从官网下载是用于Linux的Mysql安装包
wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz
```

## 安装 Mysql

```sh
# 在执行wget命令的目录下或你的上传目录下找到Mysql安装包：mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz
tar -zxvf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz

# 解压完成后，可以看到当前目录下多了一个解压文件，移动该文件到/usr/local/下，并将文件夹名称修改为mysql。
mv mysql-5.7.24-linux-glibc2.12-x86_64 /usr/local/
cd /usr/local/
mv mysql-5.7.24-linux-glibc2.12-x86_64 mysql

# 在/usr/local/mysql目录下创建data目录
mkdir /usr/local/mysql/data

# 更改mysql目录下所有的目录及文件夹所属的用户组和用户，以及权限
chown -R mysql:mysql /usr/local/mysql
chmod -R 755 /usr/local/mysql # 可读可执行 不能写

# 编译安装并初始化mysql,务必记住初始化输出日志末尾的密码（数据库管理员临时密码）
cd /usr/local/mysql/bin
./mysqld --initialize --user=mysql --datadir=/usr/local/mysql/data --basedir=/usr/local/mysql
rgrS?qY8zAr?

# 运行初始化命令成功后，输出日志如下：
2023-03-06T10:18:26.784834Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).
2023-03-06T10:18:26.948322Z 0 [Warning] InnoDB: New log files created, LSN=45790
2023-03-06T10:18:26.973997Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.
2023-03-06T10:18:27.035467Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 3bfa0313-bc08-11ed-a7ae-000c29bc20ed.
2023-03-06T10:18:27.038156Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.
2023-03-06T10:18:27.043554Z 1 [Note] A temporary password is generated for root@localhost: rgrS?qY8zAr?

# 编辑配置文件my.cnf，添加配置如下
[mysqld]
datadir=/usr/local/mysql/data
port=3306
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES
symbolic-links=0
max_connections=600
innodb_file_per_table=1
lower_case_table_names=1
character_set_server=utf8

[mysqld_safe]
log-error=/var/log/mariadb/mariadb.log

lower_case_table_names：是否区分大小写，1表示存储时表名为小写，操作时不区分大小写；0表示区分大小写；不能动态设置，修改后，必须重启才能生效：
character_set_server：设置数据库默认字符集，如果不设置默认为latin1
innodb_file_per_table：是否将每个表的数据单独存储，1表示单独存储；0表示关闭独立表空间，可以通过查看数据目录，查看文件结构的区别；
log-error：错误日志路径。需提前新建目录路径 /var/log/mariadb

# 测试启动mysql服务器
/usr/local/mysql/support-files/mysql.server start
# 报错
Starting MySQL.2023-03-06T10:25:08.910211Z mysqld_safe error: log-error set to '/var/log/mariadb/mariadb.log', however file don't exists. Create writable for user 'mysql'.
ERROR! The server quit without updating PID file (/usr/local/mysql/data/zhongnan.pid).
查看是否存在mysql和mysqld的服务，如果存在，则结束进程，再重新执行启动命令
# 查询服务
ps -ef | grep mysql | grep -v grep
ps -ef | grep mysqld | grep -v grep
# 结束进程
kill -9 PID
# 启动服务
/usr/local/mysql/support-files/mysql.server start
# 还是报同样的错误
发现没有/var/log/mariadb/mariadb.log这个路径,那我们就创建,并给mysql用户授权即可
mkdir /var/log/mariadb 
touch /var/log/mariadb/mariadb.log 
chown -R mysql:mysql  /var/log/mariadb/
# MySQL启动成功
[root@zhongnan log]# /usr/local/mysql/support-files/mysql.server start
Starting MySQL. SUCCESS! 

# 添加软连接，并重启mysql服务，（我理解为添加环境变量）
ln -s /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql
ln -s /usr/local/mysql/bin/mysql /usr/bin/mysql
ln -s /usr/local/mysql/bin/mysqldump /usr/bin
service mysql restart

# 登录mysql，修改密码(密码为步骤5生成的临时密码)
mysql -u root -p rgrS?qY8zAr?
# 报错 提示需要重置密码
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
alter user 'root'@'localhost' identified by 'jinmunan123456';

# 开放远程连接
use mysql;
update user set user.Host='%' where user.User='root';
flush privileges;

# MySQL5.7安装完成
```



